<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Gravity Sim | Mikail Khan</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Gravity Sim" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Gravity Sim" />
<meta property="og:description" content="Gravity Sim" />
<link rel="canonical" href="http://localhost:4000/2019/05/20/gravity-sim.html" />
<meta property="og:url" content="http://localhost:4000/2019/05/20/gravity-sim.html" />
<meta property="og:site_name" content="Mikail Khan" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-05-20T00:00:00-04:00" />
<script type="application/ld+json">
{"description":"Gravity Sim","url":"http://localhost:4000/2019/05/20/gravity-sim.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2019/05/20/gravity-sim.html"},"headline":"Gravity Sim","dateModified":"2019-05-20T00:00:00-04:00","datePublished":"2019-05-20T00:00:00-04:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Mikail Khan" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Mikail Khan</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Gravity Sim</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-05-20T00:00:00-04:00" itemprop="datePublished">May 20, 2019
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="gravity-sim">Gravity Sim</h1>

<p>I’ve been working on a gravity simulator in Rust for a while using a game engine called ggez. You can find it here.
https://github.com/mkhan45/gravity-sim</p>

<p>A more in-depth code overview can be found here:
https://mkhan45.github.io/blog/gravity-sim-code</p>

<p>You can find an in progress web port here:</p>

<p>https://mkhan45.github.io/gravity-sim-rs/</p>

<h2 id="what-it-does">What it does</h2>

<p>My gravity simulator simulates the gravity of point masses and completely inelastic collisions with conserved momentum. You can place bodies with a set radius, density, and velocity, and delete them by right clicking on them. You’ll see a green prediction line for them, and they leave a blue trail. Because it simulates point masses, you can simulate not only orbits, but also just random particles.</p>

<p><img src="/resources/gravity/point_masses.gif" alt="" /></p>

<h2 id="cool-stuff">Cool Stuff</h2>

<h3 id="patterns-and-step-size">Patterns and step size</h3>
<p>You can also adjust the prediction’s speed, and making it really fast reveals a lot about the simulation’s behavior and inaccuracies.</p>

<p><img src="/resources/gravity/prediction_inaccuracy.gif" alt="" /></p>

<p>In the simulation, the angle of the elliptical orbit keeps changing, and that doesn’t happen in real life. The reason for this is that computational integration always has some inaccuracy. To fix it, I added a way to adjust the step size. Lower step size means higher accuracy, but it’s also much slower.</p>

<p><img src="/resources/gravity//resources/gravity/low_step_size.gif" alt="" /></p>

<p>You can also make the step size negative, but I think that that’s enough for another blog post.</p>

<h3 id="negative-mass">Negative mass</h3>

<p>Just as you can make the step size negative, you can also make the density negative. You can probably guess that since two positive masses attract, two negative masses repel.</p>

<p><img src="/resources/gravity/negative_mass.gif" alt="" /></p>

<p>When you have one positive mass and one negative mass, the result is kind of unexpected, but it also makes complete sense.</p>

<p><img src="/resources/gravity/positive_negative.gif" alt="" /></p>

<p>The positive mass still attracts, and the negative mass still repels, so they make a train that continually accelerates from the negative mass to the positive one. Some theories say that dark matter has negative mass, and that’s why the universe is expanding.</p>

<h3 id="different-integrators">Different Integrators</h3>

<p>I learned a bit about computational integration from this project. When I realized that elliptical orbits shouldn’t change their angle, I understood how far off my integration was. At the time, I was using simple Euler integration, which means that I was simply adding the acceleration to the velocity and adding the velocity to the position at each time step. The higher the time step is, the higher the error is, since it doesn’t compensate for the acceleration that the planet undergoes during the time step. It’s like a 1st degree taylor approximation of the actual path.</p>

<p>There are many methods besides Euler’s for computational integration. Pretty much all of them are more accurate, but also a lot harder to implement. The best solution for my project, from some research, was Verlet Integration. Instead of simply adding the velocity to the position, I used these equations (images from Wikipedia):</p>

<p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/61a7664efb9226850022e1fc675a53f902bdb8cd" alt="" /></p>

<p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/596f01199cdb9b5bb35c5bf04ac54477cd085011" alt="" /></p>

<p>Basically, Verlet integration assumes that the acceleration is constant and adds the integral of the velocity over the timestep to the velocity at the start of the timestep. This makes it 100% accurate if the acceleration is constant, which it’s not.</p>

<p>Here’s the difference between Verlet and Euler integration:</p>

<p><img src="/resources/gravity/verlet.gif" alt="" /> 
<img src="/resources/gravity/euler.gif" alt="" /></p>

<p>You can see that the error for Euler integration builds up much faster, but also that energy is not conserved. Whereas Verlet integration’s error led to the ellipse rotating, Euler integration’s error causes the orbit to gradually become wider.</p>

<h3 id="dual-star-system">Dual Star System</h3>

<p><img src="/resources/gravity/dual_star.gif" alt="" /></p>

<p>You can make dual star systems, and if you’re lucky they’ll be stable. You can also do fancy stuff like nested orbits, but it’s pretty difficult. I’m planning on adding presets that you can just click a few buttons to add in because it’s such a pain to make them.</p>


  </div><a class="u-url" href="/2019/05/20/gravity-sim.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Mikail Khan</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Mikail Khan</li><li><a class="u-email" href="mailto:mikail.khan45@gmail.com">mikail.khan45@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/mkhan45"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">mkhan45</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>¯\_(ツ)_/¯</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
